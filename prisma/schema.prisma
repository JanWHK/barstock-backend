generator client { provider = "prisma-client-js" }
datasource db { provider = "postgresql"; url = env("DATABASE_URL") }

model User {
  id            String   @id @default(uuid())
  username      String   @unique
  password_hash String
  role          String   @default("staff")
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt
  daily_counts  DailyCount[] @relation("created_by")
}

model StockItem {
  id         String   @id @default(uuid())
  plu        String   @unique
  name       String
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  items      DailyCountItem[]
}

model DailyCount {
  id            String   @id @default(uuid())
  count_date    DateTime
  batch         String
  created_by_id String
  created_by    User     @relation(fields: [created_by_id], references: [id], name: "created_by")
  created_at    DateTime @default(now())
  items         DailyCountItem[]

  @@unique([count_date, batch])
  @@index([count_date(sort: Desc)])
}

model DailyCountItem {
  id             String      @id @default(uuid())
  daily_count_id String
  stock_item_id  String
  daily_count    DailyCount  @relation(fields: [daily_count_id], references: [id])
  stock_item     StockItem   @relation(fields: [stock_item_id], references: [id])
  bar            Decimal     @db.Decimal(12,3)
  cooler         Decimal     @db.Decimal(12,3)
  total          Decimal     @db.Decimal(12,3)
  note           String?

  @@unique([daily_count_id, stock_item_id])
  @@index([stock_item_id])
}
